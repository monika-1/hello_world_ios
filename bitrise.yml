---
format_version: 1.1.0
default_step_lib_source: 'https://github.com/bitrise-io/bitrise-steplib.git'
project_type: ios
trigger_map:
- push_branch: '*'
  workflow: primary
- pull_request_source_branch: '*'
  workflow: primary
workflows:
  primary:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@6: {}
    - script@1:
        inputs:
        - content: >-
            #!/usr/bin/env bash

            # fail if any commands fails

            set -e

            # debug log

            set -x


            # write your script here

            echo "Hello World!"

            echo "CKB"

            echo | pwd

            echo | ls

            cp step.yml ../step.yml

            cp step.sh ../step.sh

            cd ..


            echo | ls

            echo | pwd

            #curl
            https://df-ios-artifacts.s3.us-west-2.amazonaws.com/Test_script.sh
            -o Test_script.sh


            echo | pwd

            echo | ls


            # or run a script from your repository, like:

            # bash ./path/to/script.sh

            # not just bash, e.g.:

            # ruby ./path/to/script.rb
    - script:
        title: Create temp folder
        inputs:
        - content: |-
            #!/bin/bash

            echo "---------------MONIKA---------------"

            eval TEMP_FOLDER="$(pwd)/_tmp"

            echo "---------------MONIKA1---------------"

            if [[ -d "${TEMP_FOLDER}" ]]; then
              rm -r "${TEMP_FOLDER}"
            fi

            mkdir "${TEMP_FOLDER}"
#     - 'path::./':
#         title: Step Test
#         description: ''
#         run_if: true
#         inputs:
#         - aws_access_key: $AWS_ACCESS_KEY_ID
#         - aws_secret_access_key: $AWS_SECRET_ACCESS_KEY
#         - s3_bucket: $AWS_BUCKET
#         - s3_filepath: $AWS_FILE_PATH
#         - output_location: ./_tmp
    - script:
        title: Check environment variable
        inputs:
        - content: >-
            #!/bin/bash

            eval TEMP_FOLDER="$(pwd)/_tmp"

            if [ "${TEMP_FOLDER}/${FILE_NAME}" = "${S3_DOWNLOAD_OUTPUT_PATH}" ];
            then
              echo "Output is correctly set to ${S3_DOWNLOAD_OUTPUT_PATH}"
            else
              echo "Bad output ${S3_DOWNLOAD_OUTPUT_PATH}"
              echo "Expected ${TEMP_FOLDER}"
              exit 1
            fi
    - script:
        title: Check if file exists
        inputs:
        - content: |-
            #!/bin/bash
            if [[ -f "${S3_DOWNLOAD_OUTPUT_PATH}" ]]; then
              echo "File exists in the output path"
            else
              echo "File not downloaded"
              exit 1
            fi
    - script:
        title: Remove temp folder
        inputs:
        - content: |-
            #!/bin/bash
            eval TEMP_FOLDER="$(pwd)/_tmp"
            rm -rf "${TEMP_FOLDER}"
    - certificate-and-profile-installer@1: {}
    - recreate-user-schemes@1:
        inputs:
        - project_path: $BITRISE_PROJECT_PATH
    - xcode-archive@4:
        inputs:
        - project_path: $BITRISE_PROJECT_PATH
        - scheme: $BITRISE_SCHEME
        - distribution_method: $BITRISE_DISTRIBUTION_METHOD
    - deploy-to-bitrise-io@2: {}
meta:
  bitrise.io:
    stack: osx-xcode-12.4.x
    machine_type_id: g2.4core
app:
  envs:
  - BITRISE_PROJECT_PATH: safari/Hello World/Hello World.xcodeproj
    opts:
      is_expand: false
  - opts:
      is_expand: false
    BITRISE_SCHEME: Hello World Extension
  - opts:
      is_expand: false
    BITRISE_DISTRIBUTION_METHOD: development
